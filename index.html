<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Tamabrickchi</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    html, body {
      margin: 0;
      padding: 0;
      font-family: monospace;
      background: transparent;
      color: black;
      overflow: hidden;
      height: 100vh;
    }
    #gameWrapper {
      width: 100vw;
      height: 600px;
      position: relative;
    }
    canvas {
      width: 100%;
      height: 100%;
      display: block;
      background: transparent;
    }

    /* Boot Screen */
    #bootScreen {
      position: absolute;
      top: 0; left: 0;
      width: 100%;
      height: 100%;
      background: black;
      color: #00ff00;
      font-family: monospace;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 999;
      font-size: 16px;
      white-space: pre;
    }

    #startScreen {
      position: absolute;
      top: 0; left: 0;
      width: 100%;
      height: 100%;
      background: white;
      display: none;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 10;
      font-family: monospace;
      font-size: 14px;
      text-align: center;
      padding: 20px;
      box-sizing: border-box;
    }

    #startButton {
      margin-top: 20px;
      padding: 8px 16px;
      border: 1px solid black;
      background: transparent;
      font-family: monospace;
      cursor: pointer;
    }

    #mobileControls {
      position: absolute;
      bottom: 0;
      left: 0;
      width: 100%;
      height: 60px;
      display: none;
      z-index: 9;
      display: flex;
      justify-content: space-between;
      background: white;
      border-top: 1px dashed black;
    }

    .control-btn {
      flex: 1;
      font-size: 24px;
      text-align: center;
      user-select: none;
      padding: 10px 0;
      border-right: 1px dashed black;
    }

    .control-btn:last-child {
      border-right: none;
    }

    .popup {
      position: absolute;
      font-size: 12px;
      color: black;
      pointer-events: none;
      animation: floatUp 0.5s ease-out forwards;
    }

    @keyframes floatUp {
      from {
        opacity: 1;
        transform: translateY(0);
      }
      to {
        opacity: 0;
        transform: translateY(-20px);
      }
    }

    .overlay {
      position: absolute;
      top: 0; left: 0;
      width: 100%;
      height: 100%;
      background: white;
      color: black;
      font-family: monospace;
      font-size: 18px;
      z-index: 999;
      display: none;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      text-align: center;
      padding: 20px;
      box-sizing: border-box;
    }

    .overlay button {
      margin-top: 20px;
      padding: 8px 16px;
      border: 1px solid black;
      background: transparent;
      font-family: monospace;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <div id="gameWrapper">
    <div id="bootScreen" id="boot">
T  
 A  
  M  
   A  
    B  
     R  
      I  
       C  
        K  
         C  
          H  
           I  

> System booting  
> Nothing to save  
> Nothing to load  
> Paddle linked  
> Ball containment... unstable  
> Echoes detected  
> Begin if you must_
    </div>

    <div id="startScreen">
      <h1 style="margin-bottom: 10px;">TAMABRICKCHI</h1>
      <pre style="margin: 0; font-size: 14px;">
HOW TO PLAY (not that it’ll save you)

Use ← / → to drag your sad little paddle through the void
Tap LEFT or RIGHT if you're stuck in mobile purgatory
Press SPACE to launch the ball and your fleeting sense of purpose
Break all the AUDIO and ECHOES blocks because silence is worse
Gain +1 second for every block you hit
Game over if time runs out or you drop the ball
Which, let’s face it, we all do eventually
      </pre>
      <button id="startButton">START</button>
    </div>

    <canvas id="gameCanvas"></canvas>

    <div id="mobileControls">
      <div id="leftBtn" class="control-btn">◀</div>
      <div id="rightBtn" class="control-btn">▶</div>
    </div>

    <div id="winScreen" class="overlay">
      <h1>YOU WIN</h1>
      <p>Nothing left<br>Nothing gained</p>
      <button onclick="location.reload()">Play again?</button>
    </div>

    <div id="loseScreen" class="overlay">
      <h1>YOU LOSE</h1>
      <p>Time wins<br>You didn't</p>
      <button onclick="location.reload()">Retry?</button>
    </div>
  </div>

  <script>
    window.addEventListener('DOMContentLoaded', () => {
      const canvas = document.getElementById('gameCanvas');
      const ctx = canvas.getContext('2d');
      const isTouch = 'ontouchstart' in window || navigator.maxTouchPoints > 0;

      let width, height;
      function resizeCanvas() {
        width = canvas.clientWidth;
        height = canvas.clientHeight;
        canvas.width = width;
        canvas.height = height;
      }
      resizeCanvas();
      window.addEventListener('resize', resizeCanvas);

      let blocks = [], blockW, blockH = 48, rows = 2, cols = 8;
      let paddle = {}, ball = {};
      let isLeft = false, isRight = false, launched = false;
      let timer = 30;
      let gameLoop, timerLoop;
      const blockWords = ['AUDIO', 'ECHOES'];
      const popups = [];

      function resetGame() {
        paddle = {
          w: width / 5,
          h: 16,
          x: width / 2 - width / 10,
          y: height - 60,
          speed: 5
        };
        ball = {
          x: width / 2,
          y: paddle.y - 12,
          r: 6,
          dx: 3,
          dy: -3
        };
        launched = false;
        timer = 30;
        generateBlocks();
        popups.length = 0;
      }

      function generateBlocks() {
        blocks = [];
        blockW = width / cols;
        for (let r = 0; r < rows; r++) {
          let row = [];
          for (let c = 0; c < cols; c++) {
            const word = blockWords[(r * cols + c) % blockWords.length];
            row.push({
              x: c * blockW,
              y: 30 + r * blockH,
              text: word,
              hit: false
            });
          }
          blocks.push(row);
        }
      }

      function createPopup(x, y, text) {
        const popup = document.createElement('div');
        popup.className = 'popup';
        popup.textContent = text;
        popup.style.left = x + 'px';
        popup.style.top = y + 'px';
        document.body.appendChild(popup);
        setTimeout(() => {
          popup.remove();
        }, 500);
      }

      function drawExplosion(x, y) {
        ctx.fillStyle = 'red';
        ctx.beginPath();
        ctx.arc(x, y, 10 + Math.random() * 5, 0, Math.PI * 2);
        ctx.fill();
        ctx.fillStyle = 'orange';
        ctx.beginPath();
        ctx.arc(x, y, 5 + Math.random() * 2, 0, Math.PI * 2);
        ctx.fill();
      }

      function drawBlocks() {
        ctx.font = `${blockH * 0.4}px monospace`;
        ctx.textAlign = 'center';
        ctx.textBaseline = 'middle';
        blocks.forEach(row => row.forEach(b => {
          if (!b.hit) {
            ctx.strokeStyle = 'black';
            ctx.strokeRect(b.x, b.y, blockW, blockH);
            ctx.fillStyle = 'black';
            ctx.fillText(b.text, b.x + blockW / 2, b.y + blockH / 2);
          }
        }));
      }

      function drawPaddleWithClock() {
        ctx.fillStyle = 'black';
        ctx.fillRect(paddle.x, paddle.y, paddle.w, paddle.h);

        const clockText = `${timer}s`;
        ctx.font = '12px monospace';
        ctx.fillStyle = 'white';
        ctx.textAlign = 'center';
        ctx.textBaseline = 'middle';
        ctx.fillText(clockText, paddle.x + paddle.w / 2, paddle.y + paddle.h / 2);
      }

      function draw() {
        ctx.clearRect(0, 0, width, height);
        drawBlocks();
        drawPaddleWithClock();

        ctx.beginPath();
        ctx.arc(ball.x, ball.y, ball.r, 0, Math.PI * 2);
        ctx.fillStyle = 'black';
        ctx.fill();
      }

      function update() {
        if (!launched) {
          ball.x = paddle.x + paddle.w / 2;
          ball.y = paddle.y - ball.r;
        } else {
          ball.x += ball.dx;
          ball.y += ball.dy;
        }

        if (blocks.flat().every(b => b.hit)) showWin();

        if (isLeft) paddle.x -= paddle.speed;
        if (isRight) paddle.x += paddle.speed;
        paddle.x = Math.max(0, Math.min(width - paddle.w, paddle.x));

        if (ball.x <= ball.r || ball.x >= width - ball.r) ball.dx *= -1;
        if (ball.y <= ball.r) ball.dy *= -1;

        if (
          ball.y + ball.r >= paddle.y &&
          ball.x >= paddle.x &&
          ball.x <= paddle.x + paddle.w
        ) {
          ball.dy *= -1;
          ball.y = paddle.y - ball.r;
        }

        blocks.forEach(row => row.forEach(b => {
          if (!b.hit &&
              ball.x >= b.x && ball.x <= b.x + blockW &&
              ball.y >= b.y && ball.y <= b.y + blockH) {
            b.hit = true;
            ball.dy *= -1;
            timer++;
            drawExplosion(ball.x, ball.y);
            createPopup(ball.x, ball.y, '+1 Second');
          }
        }));

        if (ball.y > height) showLose();
      }

      function loop() {
        update();
        draw();
        gameLoop = requestAnimationFrame(loop);
      }

      function startGame() {
        document.getElementById('startScreen').style.display = 'none';
        resetGame();
        loop();
        timerLoop = setInterval(() => {
          if (launched) timer--;
          if (timer <= 0) showLose();
        }, 1000);
      }

      function showWin() {
        cancelAnimationFrame(gameLoop);
        clearInterval(timerLoop);
        document.getElementById('winScreen').style.display = 'flex';
      }

      function showLose() {
        cancelAnimationFrame(gameLoop);
        clearInterval(timerLoop);
        document.getElementById('loseScreen').style.display = 'flex';
      }
      document.getElementById('startButton').addEventListener('click', startGame);

      // Key controls
      window.addEventListener('keydown', e => {
        if (e.key === 'ArrowLeft') isLeft = true;
        if (e.key === 'ArrowRight') isRight = true;
        if (e.key === ' ' && !launched) launched = true;
        if (booting && !startTriggered) triggerStart();
      });

      window.addEventListener('keyup', e => {
        if (e.key === 'ArrowLeft') isLeft = false;
        if (e.key === 'ArrowRight') isRight = false;
      });

      // Touch support
      if (isTouch) {
        const mobileControls = document.getElementById('mobileControls');
        mobileControls.style.display = 'flex';

        const left = document.getElementById('leftBtn');
        const right = document.getElementById('rightBtn');

        left.addEventListener('touchstart', () => isLeft = true);
        left.addEventListener('touchend', () => isLeft = false);
        right.addEventListener('touchstart', () => isRight = true);
        right.addEventListener('touchend', () => isRight = false);

        // Start on first touch (boot)
        window.addEventListener('touchstart', () => {
          if (booting && !startTriggered) triggerStart();
        });
      }

      // Bootscreen logic
      let booting = true;
      let startTriggered = false;
      function triggerStart() {
        startTriggered = true;
        const boot = document.getElementById('bootScreen');
        boot.style.display = 'none';
        document.getElementById('startScreen').style.display = 'flex';
        booting = false;
      }
    });
  </script>
</body>
</html>
